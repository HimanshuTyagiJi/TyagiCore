<!DOCTYPE html>
<html lang="{% if page.lang == 'hi' %}hi{% else %}en{% endif %}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

{% seo %}

<meta name="author"  content="{{ site.author }}">
<meta name="robots" content="index, follow">

{% if page.image %}
<meta property="og:image"        content="{{ page.image | absolute_url }}">
<meta property="og:image:width"  content="1280">
<meta property="og:image:height" content="720">
<meta name="twitter:image"       content="{{ page.image | absolute_url }}">
<meta name="twitter:card"        content="summary_large_image">
{% else %}
<meta name="twitter:card" content="summary">
{% endif %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  {% if page.is_post %}
  "@type": "Article",
  "headline": {{ page.title | jsonify }},
  "description": {{ page.description | default: site.description | jsonify }},
  "url": "{{ page.url | absolute_url }}",
  {% if page.image %}"image": "{{ page.image | absolute_url }}",{% endif %}
  "author": {"@type":"Person","name":"{{ site.author }}"},
  "publisher": {"@type":"Organization","name":"{{ site.title }}","url":"{{ site.url }}"}
  {% else %}
  "@type": "WebSite",
  "name": {{ site.title | jsonify }},
  "description": {{ site.description | jsonify }},
  "url": "{{ site.url }}",
  "publisher": {"@type":"Organization","name":"{{ site.title }}","url":"{{ site.url }}"}
  {% endif %}
}
</script>

<link rel="stylesheet" href="{{ '/assets/css/style.css' | absolute_url }}">
</head>
<body>

<!-- HEADER -->
<header class="tc-header-bar" role="banner">
  <div class="header-inner">
    <a href="{{ '/' | absolute_url }}" class="logo"  aria-label="{{ site.title }} Home"><img src="{{ 'assets/images/tyagi_core.png' | relative_url }}" alt="Tyagi Core" style="height: 40px; vertical-align: middle;">

      <svg width="155" height="38" viewBox="0 0 490 118" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
          <linearGradient id="logoG" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#1a73e8"/>
            <stop offset="45%"  stop-color="#AB1912"/>
            <stop offset="100%" stop-color="#f97316"/>
          </linearGradient>
        </defs>
        <text x="8" y="54" font-size="64" font-weight="900" font-family="Georgia,serif"
          fill="none" stroke="url(#logoG)" stroke-width="2.4"
          stroke-dasharray="760" stroke-dashoffset="760">Tyagi
          <animate attributeName="stroke-dashoffset" values="760;0" dur="1.6s" fill="freeze"/>
        </text>
        <text x="8" y="108" font-size="50" font-weight="900" font-family="Georgia,serif"
          fill="none" stroke="url(#logoG)" stroke-width="2">CORE
          <animate attributeName="stroke-width" values="2;3;2" dur="3s" repeatCount="indefinite"/>
        </text>
      </svg>
    </a>
    <nav class="nav" role="navigation" aria-label="Main navigation">
      <a href="{{ '/' | absolute_url }}">Home</a>
      <a href="{{ '/about' | absolute_url }}">About</a>
      <a href="{{ '/privacy' | absolute_url }}">Privacy</a>
      <a href="{{ '/terms' | absolute_url }}">Terms</a>
    </nav>
    <div class="right-icons">
      <button class="icon-btn" onclick="toggleSearch(true)" aria-label="Search">
        <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/></svg>
      </button>
      <button class="icon-btn hamburger" onclick="toggleMenu(true)" aria-label="Open menu" aria-expanded="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
    </div>
  </div>
</header>

<div id="reading-progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Reading progress">
  <div id="reading-progress-bar"></div>
</div>

<!-- SEARCH MODAL -->
<div id="searchModal" role="dialog" aria-modal="true" aria-label="Search" onclick="closeOnOverlay(event)" style="display:none">
  <div class="search-box">
    <div class="search-input-area">
      <label for="searchInput" class="sr-only">Search</label>
      <input type="search" id="searchInput" placeholder="Search articles..." onkeyup="globalSearch()" autocomplete="off">
      <button class="close-modal" onclick="toggleSearch(false)" aria-label="Close">‚úï</button>
    </div>
    <div id="searchResults" role="listbox">
      <p style="text-align:center;padding:20px;color:#94a3b8;">Type to search...</p>
    </div>
  </div>
</div>

<!-- MOBILE MENU -->
<div class="mobile-overlay" onclick="toggleMenu(false)" aria-hidden="true"></div>
<nav class="mobile-menu" role="navigation" aria-label="Mobile menu">
  <div class="mobile-header" style="border-bottom:1px solid #ccc;"><img src="{{ 'assets/images/tyagi_core.png' | relative_url }}" alt="Tyagi Core" style="height: 40px; vertical-align: middle;">
    <span style="font-weight:900;font-size:20px;background:linear-gradient(135deg,#1a73e8,#AB1912,#f97316);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">TYAGI CORE</span>
    <button onclick="toggleMenu(false)" aria-label="Close" style="background:none;border:none;font-size:22px;cursor:pointer;color:var(--text-color)">‚úï</button>
  </div>
  <div class="mobile-nav">
    <a href="{{ '/' | absolute_url }}">üè† Home</a>
    <a href="{{ '/about' | absolute_url }}">üë§ About</a>
    <a href="{{ '/privacy' | absolute_url }}">üîí Privacy</a>
    <a href="{{ '/terms' | absolute_url }}">üìÑ Terms</a>
  </div>
</nav>

{% if page.url == "/" or page.url == "/index.html" %}
<section class="tc-hero" aria-label="Welcome">
  <div class="hero-content">
    <span class="hero-badge">üöÄ Tech ¬∑ Security ¬∑ AI ¬∑ Linux</span>
    <h1>Build Real Tech From Scratch</h1>
    <p>Practical guides & projects to master the digital world</p>
    <div class="hero-btns">
      <a href="#posts" class="btn btn-primary">Learn Now</a>
      <a href="{{ '/about' | absolute_url }}" class="btn btn-outline">About Us</a>
    </div>
  </div>
</section>
{% endif %}

<div id="index-category-nav"></div>

<!-- MAIN LAYOUT -->
<main class="tc-wrapper" id="main-content">
  <div class="tc-left">

{% if page.is_post %}
      {% assign words = content | number_of_words %}
      {% if words < 360 %}
        {% assign read_time = "2 min read" %}
      {% else %}
        {% assign minutes = words | divided_by: 180 %}
        {% assign read_time = minutes | append: " min read" %}
      {% endif %}

      <h1 class="post-title" style="margin-bottom:10px;">{{ page.title }}</h1>
      
      <p style="color:var(--text-muted);font-size:14px;margin-bottom:28px;">
        By {{ page.author | default: "Himanshu Tyagi" }} ¬∑ 
        {{ page.date | date: "%B %Y" }} ¬∑ 
        <span class="read-time"><i class="far fa-clock"></i> {{ read_time }}</span>
      </p> 
        
        {% if page.image %}
<div class="post-hero-img" id="post-hero-wrap">
    
        <img src="{{ page.image | relative_url }}" alt="{{ page.title }}" width="1280" height="720" style="border-radius:12px; width:100%; height:auto;">
      </div>
      {% endif %}

      <div class="toc-container" id="toc-box" style="display:none; margin-bottom:30px;">
        <div class="toc-title"><i class="fas fa-list-ul"></i>&nbsp; Topics</div>
        <ul id="toc-list" role="list"></ul>
        <button id="toc-toggle-btn" class="toc-see-more" aria-expanded="false">
          See More <i class="fas fa-chevron-down"></i>
        </button>
      </div>
    {% endif %}

    {{ content }}

    {% unless page.url == "/" or page.url == "/index.html" %}
    {% if page.is_post %}
    <div class="share-wrapper">
      <p class="share-label">Share With Friends üöÄ</p>
      <button onclick="tyagiShare()" class="tyagi-share-btn" aria-label="Share this article">
        <i class="fas fa-paper-plane" aria-hidden="true"></i> SHARE ARTICLE
      </button>
    </div>

    {% assign all_posts = site.pages | where: "is_post", true | sort: "date" %}
    {% assign post_count = all_posts | size %}
    {% assign current_index = nil %}
    {% for p in all_posts %}
      {% if p.url == page.url %}{% assign current_index = forloop.index0 %}{% endif %}
    {% endfor %}

    {% if current_index != nil %}
    {% assign prev_index = current_index | minus: 1 %}
    {% assign next_index = current_index | plus: 1 %}
    <nav class="post-nav-container" aria-label="Post navigation">
      <div class="post-nav-link prev">
        {% if current_index > 0 %}
          {% assign prev_post = all_posts[prev_index] %}
          <a href="{{ prev_post.url | relative_url }}">
            <span class="nav-label"><i class="fas fa-arrow-left" aria-hidden="true"></i> Previous Post</span>
            <div class="nav-post-title">{{ prev_post.title }}</div>
          </a>
        {% else %}
          <span class="nav-disabled"><span class="nav-label">Previous Post</span><div class="nav-post-title" style="opacity:0.4;">No previous post</div></span>
        {% endif %}
      </div>
      <div class="post-nav-link next">
        {% if next_index < post_count %}
          {% assign next_post = all_posts[next_index] %}
          <a href="{{ next_post.url | relative_url }}">
            <span class="nav-label">Next Post <i class="fas fa-arrow-right" aria-hidden="true"></i></span>
            <div class="nav-post-title">{{ next_post.title }}</div>
          </a>
        {% else %}
          <span class="nav-disabled"><span class="nav-label">Next Post</span><div class="nav-post-title" style="opacity:0.4;">No next post</div></span>
        {% endif %}
      </div>
    </nav>
    {% endif %}
    <hr style="margin:44px 0;border:none;border-top:1px solid var(--border-color)">
    {% endif %}
    {% endunless %}
  </div>

  <!-- SIDEBAR -->
  <aside class="tc-sidebar" aria-label="Sidebar">
    <div class="box">üî• Trending Now</div>
    <div id="trending-sidebar-items"></div>
    <div class="box" style="margin-top:18px;">üì° Follow Us</div>
    <div class="tyagi-social-hub">
      <a class="hub-card yt-main"    href="https://youtube.com/@tyagicore"      target="_blank" rel="noopener noreferrer"><div class="hub-icon"><i class="fab fa-youtube"></i></div><div class="hub-info"><span class="hub-name">TyagiCore</span><span class="hub-desc">Tech & Systems</span></div><div class="hub-action">Join</div></a>
      <a class="hub-card study-card" href="https://youtube.com/@gklearnstudy"   target="_blank" rel="noopener noreferrer"><div class="hub-icon"><i class="fas fa-graduation-cap"></i></div><div class="hub-info"><span class="hub-name">GK Learn Study</span><span class="hub-desc">Education</span></div><div class="hub-action">Join</div></a>
      <a class="hub-card ig-card"    href="https://instagram.com/tyagicore"     target="_blank" rel="noopener noreferrer"><div class="hub-icon"><i class="fab fa-instagram"></i></div><div class="hub-info"><span class="hub-name">Instagram</span><span class="hub-desc">Daily Updates</span></div><div class="hub-action">Follow</div></a>
      <a class="hub-card fb-card"    href="https://facebook.com/himanshutyagie" target="_blank" rel="noopener noreferrer"><div class="hub-icon"><i class="fab fa-facebook-f"></i></div><div class="hub-info"><span class="hub-name">Facebook</span><span class="hub-desc">Community</span></div><div class="hub-action">Like</div></a>
      <a class="hub-card tg-card"    href="https://t.me/TyagiCore"              target="_blank" rel="noopener noreferrer"><div class="hub-icon"><i class="fab fa-telegram-plane"></i></div><div class="hub-info"><span class="hub-name">Telegram</span><span class="hub-desc">Files & Updates</span></div><div class="hub-action">Join</div></a>
    </div>
    <div class="box" style="margin-top:18px;">üì± Our Apps</div>
    <div class="tyagi-app-container">
      <div class="app-card">
        <div class="app-logo-box" style="background:#1a73e8">TC</div>
        <div class="app-details"><span class="app-name">TyagiCore</span><span class="app-meta">v1.1</span></div>
        <span class="download-btn">Coming Soon</span>
      </div>
      <div class="app-card">
        <div class="app-logo-box" style="background:#AB1912">GK</div>
        <div class="app-details"><span class="app-name">GK Learn Quiz</span><span class="app-meta">v2.0</span></div>
        <span class="download-btn">Coming Soon</span>
      </div>
    </div>
  </aside>
</main>

{% if page.url == "/" or page.url == "/index.html" %}
<section class="tc-bottom-section" aria-label="About Tyagi Core">
  <div class="tc-ultra-final">
    <div class="bg-mesh" aria-hidden="true"></div>
    <div class="section-header">
      <span class="badge">Tyagi Core Framework</span>
      <h2>Architecting The Future of Digital Systems</h2>
      <p class="subtext">A structured knowledge engine focused on how modern digital infrastructure truly operates at its foundational level.</p>
    </div>
    <div class="tc-grid">
      <div class="tc-feat-card">
        <div class="feat-icon"><svg viewBox="0 0 100 100" width="56" height="56"><circle cx="50" cy="50" r="38" fill="none" stroke="#1a73e8" stroke-width="1.5" stroke-dasharray="380" stroke-dashoffset="380"><animate attributeName="stroke-dashoffset" values="380;0" dur="2s" fill="freeze"/></circle><circle cx="50" cy="50" r="16" fill="none" stroke="#1a73e8" stroke-width="1.5" stroke-dasharray="100" stroke-dashoffset="100"><animate attributeName="stroke-dashoffset" values="100;0" dur="2s" begin="0.4s" fill="freeze"/></circle></svg></div>
        <h3>Deep System Architecture</h3>
        <p>TCP/IP routing, kernel models, memory allocation ‚Äî we analyze how every layer interacts and how data travels in real time.</p>
      </div>
      <div class="tc-feat-card">
        <div class="feat-icon"><svg viewBox="0 0 100 100" width="56" height="56"><path d="M50 10 L85 25 V55 C85 75 70 90 50 95 C30 90 15 75 15 55 V25 Z" fill="none" stroke="#AB1912" stroke-width="1.5" stroke-dasharray="480" stroke-dashoffset="480"><animate attributeName="stroke-dashoffset" values="480;0" dur="2s" fill="freeze"/></path></svg></div>
        <h3>Cyber Defense & Privacy</h3>
        <p>Firewall architecture, encryption layers, zero-trust systems ‚Äî security is architecture-based, not fear-based.</p>
      </div>
      <div class="tc-feat-card">
        <div class="feat-icon"><svg viewBox="0 0 100 100" width="56" height="56"><circle cx="20" cy="50" r="8" fill="none" stroke="#f97316" stroke-width="1.5"/><circle cx="80" cy="50" r="8" fill="none" stroke="#f97316" stroke-width="1.5"/><circle cx="50" cy="20" r="8" fill="none" stroke="#f97316" stroke-width="1.5"/><circle cx="50" cy="80" r="8" fill="none" stroke="#f97316" stroke-width="1.5"/><line x1="28" y1="50" x2="42" y2="50" stroke="#f97316" stroke-width="1.5"/><line x1="58" y1="50" x2="72" y2="50" stroke="#f97316" stroke-width="1.5"/><line x1="50" y1="28" x2="50" y2="42" stroke="#f97316" stroke-width="1.5"/><line x1="50" y1="58" x2="50" y2="72" stroke="#f97316" stroke-width="1.5"/></svg></div>
        <h3>Distributed Networks</h3>
        <p>CDN logic, load balancing, latency optimization ‚Äî engineer performance, not guess it.</p>
      </div>
    </div>
  </div>
</section>
{% endif %}

<button id="dark-mode-toggle" class="theme-wheel" aria-label="Toggle dark/light mode">
  <div class="wheel-icon-wrap">
    <svg class="moon-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>

   
    <svg class="sun-icon sun" width="24" height="24"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </div>
</button>

  
<style>
 
  

 

 
  .sun {
    animation: spin 8s linear infinite;
  }
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

 
 
</style>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COMMENTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
{% if page.is_post %}
<div id="tc-root" role="region" aria-label="Comments">
  <div class="tc-comments-header">
    <div class="tc-header-left">
      <h2 style="margin:0;font-size:17px;">Discussion &amp; Reviews</h2>
      <div class="tc-ps-rating">
        <span id="tc-avg-num" class="tc-avg-big">0.0</span>
        <div class="tc-ps-stars-wrap">
          <div id="tc-avg-stars" class="tc-stars-fs">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <div id="tc-total-votes" class="tc-total-v">0 reviews</div>
        </div>
      </div>
    </div>
    <div id="tc-auth-zone" style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
      <div id="tc-auth-gate">
        <div id="g_id_onload"
          data-client_id="307990626713-iajvibefe9hrour51knqkcc5obouuher.apps.googleusercontent.com"
          data-callback="onGoogleAuth"
          data-auto_select="false"
          data-skip_prompt_cookie="tc_skip_prompt">
        </div>
        <div class="g_id_signin" data-type="standard" data-shape="pill"></div>
      </div>
      <div id="tc-user-pill" style="display:none;" class="tc-user-pill">
        <img id="tc-user-pfp" src="" class="tc-pfp-small" alt="Profile">
        <span id="tc-user-name" class="tc-u-name"></span>
        <button onclick="tcLogout()" class="tc-logout-btn">Logout</button>
      </div>
    </div>
  </div>

  <div class="tc-user-rate-box">
    <p style="margin:0 0 5px;font-size:12px;color:var(--text-muted,#666)">Tap stars to rate:</p>
    <div id="tc-star-row" class="tc-stars-input">
      <span class="tc-s" onclick="handleStar(1)" onmouseover="hoverStar(1)" onmouseout="resetStar()">‚òÖ</span>
      <span class="tc-s" onclick="handleStar(2)" onmouseover="hoverStar(2)" onmouseout="resetStar()">‚òÖ</span>
      <span class="tc-s" onclick="handleStar(3)" onmouseover="hoverStar(3)" onmouseout="resetStar()">‚òÖ</span>
      <span class="tc-s" onclick="handleStar(4)" onmouseover="hoverStar(4)" onmouseout="resetStar()">‚òÖ</span>
      <span class="tc-s" onclick="handleStar(5)" onmouseover="hoverStar(5)" onmouseout="resetStar()">‚òÖ</span>
    </div>
  </div>

  <div id="tc-main-editor" class="tc-editor-box">
    <textarea id="tc-input" placeholder="Join the discussion..."></textarea>
    <div style="text-align:right;margin-top:8px;">
      <button onclick="handleAction('0')" class="tc-post-btn">Post Comment</button>
    </div>
  </div>

  <div id="tc-feed" class="tc-feed" role="list"></div>
</div>

<!-- Firebase ‚Äî onMessage sirf EK baar register hoga -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-messaging.js";

const FB_CONFIG = {
  apiKey:"AIzaSyCFIKqQ5OICMZhWPtZqmgem0bEW7QpoPcw", authDomain:"appcomment.firebaseapp.com",
  projectId:"appcomment", storageBucket:"appcomment.firebasestorage.app",
  messagingSenderId:"156258808941", appId:"1:156258808941:web:04a1f7470ac43657c7fb64"
};
const VAPID      = "BPSPa7nCW1nGok9peZQepk25VC1OxeFxFHtWVZsen2TnwVCya3Sq2Dtb4W0sX8u06fRsg-eAqgxEUoW2XP1Oyvo";
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzN_IpDncCGpgAWzLph8EqtDGfjed1C-Xr3ItHNYWFnyp0J7z6B-oh4fGG3FWXD9tHq/exec";
const messaging  = getMessaging(initializeApp(FB_CONFIG));

// ‚úÖ onMessage sirf EK baar register ‚Äî flag se double prevent
var _msgListenerSet = false;

window._tcInitFCM = async function() {
  var u = JSON.parse(localStorage.getItem("tc_user")); if (!u) return;
  try {
    var sw = await navigator.serviceWorker.register("/sw.js", { scope:"/" });
    await navigator.serviceWorker.ready;
    var perm = await Notification.requestPermission(); if (perm !== "granted") return;
    var token = await getToken(messaging, { vapidKey:VAPID, serviceWorkerRegistration:sw });
    if (token) {
      localStorage.setItem("tc_fcm_token", token);
      localStorage.setItem("tc_notif_enabled", "1");
      fetch(SCRIPT_URL, { method:"POST", mode:"no-cors",
        body: JSON.stringify({ action:"fcm_subscribe", fcmToken:token, email:u.e, name:u.n }) });
    }
  } catch(e) { console.log("FCM:", e); }

  // ‚úÖ onMessage sirf ek baar lagao
  if (!_msgListenerSet) {
    _msgListenerSet = true;
    onMessage(messaging, function(payload) {
      var title = (payload.notification||{}).title || "TyagiCore üîî";
      var body  = (payload.notification||{}).body  || "";
      var url   = (payload.data && payload.data.url) || "https://tyagicore.gklearnstudy.in";
      navigator.serviceWorker.ready.then(function(reg) {
        reg.showNotification(title, {
          body:body, icon:"/assets/images/tyagi_core.png",
          tag:"tc-notif", // ‚úÖ tag fixed ‚Äî same tag = sirf ek notification replace hoga
          data:{url:url}, vibrate:[200,100,200]
        });
      });
    });
  }
};

// ‚úÖ load event HATAYA ‚Äî yahan se dobara call nahi hoga
// init() se hi _tcInitFCM call hoga, ek baar
</script>

<!-- Comment Logic -->
<script>
(function() {
  var SU = "https://script.google.com/macros/s/AKfycbzN_IpDncCGpgAWzLph8EqtDGfjed1C-Xr3ItHNYWFnyp0J7z6B-oh4fGG3FWXD9tHq/exec";
  var user          = JSON.parse(localStorage.getItem("tc_user")) || null;
  var serverData    = [];
  var tempLocal     = [];
  var localLikes    = {};
  var isTyping      = false;
  var currentRating = 0;

  function init() {
    if (user) {
      document.getElementById("tc-auth-gate").style.display = "none";
      document.getElementById("tc-user-pill").style.display = "flex";
      document.getElementById("tc-user-name").innerText     = user.n;
      document.getElementById("tc-user-pfp").src            = user.p;
      document.cookie = "tc_skip_prompt=1; path=/; max-age=2592000; SameSite=Lax";
      // ‚úÖ sirf yahan se ek baar call
      setTimeout(function(){ if(window._tcInitFCM) window._tcInitFCM(); }, 1500);
    }
    sync();
    setInterval(function(){ if(!isTyping) sync(); }, 5000);
  }

  window.onGoogleAuth = function(r) {
    if (user) return;
    var p = JSON.parse(atob(r.credential.split(".")[1]));
    user  = { n:p.name, e:p.email, p:p.picture };
    localStorage.setItem("tc_user", JSON.stringify(user));
    document.cookie = "tc_skip_prompt=1; path=/; max-age=2592000; SameSite=Lax";
    document.getElementById("tc-auth-gate").style.display = "none";
    document.getElementById("tc-user-pill").style.display = "flex";
    document.getElementById("tc-user-name").innerText     = user.n;
    document.getElementById("tc-user-pfp").src            = user.p;
    setTimeout(function(){ if(window._tcInitFCM) window._tcInitFCM(); }, 800);
    sync();
  };

  window.tcLogout = function() {
    localStorage.removeItem("tc_user");
    localStorage.removeItem("tc_notif_enabled");
    localStorage.removeItem("tc_fcm_token");
    document.cookie = "tc_skip_prompt=; path=/; max-age=0";
    location.reload();
  };

  window.hoverStar = function(n){ if(!isTyping && currentRating===0) paintStars(n); };
  window.resetStar = function()  { paintStars(currentRating); };
  window.handleStar = function(n) {
    if (!user) return alert("Login required!");
    currentRating = n; paintStars(n);
    fetch(SU, { method:"POST", mode:"no-cors",
      body: JSON.stringify({ url:location.pathname, email:user.e, rating:n, comment:"__RATING_ONLY__" }) });
  };
  function paintStars(n) {
    document.querySelectorAll(".tc-s").forEach(function(s,i){ s.classList.toggle("active", i<n); });
  }

  window.handleLike = function(rowId) {
    if (!user) return alert("Please Login!");
    var btn     = document.getElementById("like-btn-"+rowId);
    var countEl = document.getElementById("like-count-"+rowId);
    if (btn) {
      var isLiked  = btn.getAttribute("data-liked") === "1";
      var count    = parseInt(countEl ? countEl.innerText : "0") || 0;
      var newState = !isLiked;
      localLikes[rowId] = newState;
      btn.setAttribute("data-liked", newState ? "1" : "0");
      btn.innerHTML = newState ? "‚ù§Ô∏è" : "ü§ç";
      btn.style.transform = "scale(1.3)";
      setTimeout(function(){ btn.style.transform = "scale(1)"; }, 250);
      if (countEl) countEl.innerText = newState ? count+1 : Math.max(0, count-1);
    }
    fetch(SU, { method:"POST", mode:"no-cors",
      body: JSON.stringify({ action:"like", rowId:rowId, email:user.e }) });
    setTimeout(sync, 1500);
  };

  window.handleAction = function(pid, mode, rowId) {
    mode = mode||"new"; rowId = rowId||null;
    if (!user) return alert("Please Login!");
    var inputId = mode==="edit" ? "edit-in-"+rowId : (pid==="0" ? "tc-input" : "reply-in-"+pid);
    var inputEl = document.getElementById(inputId);
    var msg     = inputEl ? inputEl.value.trim() : "";
    if (!msg) return;
    if (mode === "new") {
      tempLocal.push({
        rowId:"temp_"+Date.now(), name:user.n, comment:msg,
        parentId:pid, pic:user.p, date:"Saving...", pending:true,
        isAdmin:false, isPostAdmin:false, email:user.e,
        likesCount:0, isLiked:false, _localMsg:msg
      });
    } else {
      var t = serverData.find(function(c){ return c.rowId == rowId; });
      if (t) { t.comment = msg; t.date = "Updating..."; }
    }
    render(); inputEl.value = ""; isTyping = false;
    var pl = { url:location.pathname, name:user.n, email:user.e,
               pic:user.p, comment:msg, parentId:pid, rating:currentRating };
    if (mode === "edit") { pl.action = "edit"; pl.rowId = rowId; }
    fetch(SU, { method:"POST", body:JSON.stringify(pl), mode:"no-cors" });
    setTimeout(sync, 1500);
  };

  async function sync() {
    try {
      var ep   = user ? "&email="+encodeURIComponent(user.e) : "";
      var r    = await fetch(SU+"?url="+location.pathname+ep);
      var data = await r.json();
      serverData = data.comments || [];
      // ‚úÖ tempLocal sirf tabhi hatao jab server pe confirm ho jaye
      tempLocal = tempLocal.filter(function(t) {
        return !serverData.some(function(s) {
          return s.email === t.email && s.comment === t._localMsg;
        });
      });
      if (user && data.myRating > 0) currentRating = data.myRating;
      updateRatingUI(data.avgRating, data.totalVotes);
      paintStars(currentRating);
      render();
    } catch(e) {}
  }

  function updateRatingUI(avg, total) {
    document.getElementById("tc-avg-num").innerText     = avg;
    document.getElementById("tc-total-votes").innerText = (total||0)+" reviews";
    var s = "", r = Math.round(parseFloat(avg)||0);
    for (var i=1; i<=5; i++) s += i<=r ? "‚òÖ" : "‚òÜ";
    document.getElementById("tc-avg-stars").innerText = s;
  }

  function render() {
    var feed = document.getElementById("tc-feed");
    var all  = serverData.concat(tempLocal);
    feed.innerHTML = all
      .filter(function(c){ return c.parentId == "0"; })
      .reverse()
      .map(function(c){ return renderCard(c, all); })
      .join("");
  }

  function renderCard(c, list) {
    var isMine    = user && (user.e === c.email);
    var amIAdmin  = (c.isAdmin === true);
    var canEdit   = isMine || amIAdmin;
    var canDelete = isMine || amIAdmin;
    var starStr   = c.userRating > 0
      ? '<span style="color:#f4b400;font-size:10px;margin-left:8px;">'+"‚òÖ".repeat(c.userRating)+'</span>' : "";
    var serverLiked = c.isLiked || false;
    var isLiked     = (c.rowId in localLikes) ? localLikes[c.rowId] : serverLiked;
    var likeCount   = c.likesCount || 0;
    if (c.rowId in localLikes && localLikes[c.rowId] !== serverLiked) {
      likeCount = localLikes[c.rowId] ? likeCount+1 : Math.max(0, likeCount-1);
    }

    var html = '<div class="tc-card '+(c.parentId!=="0"?"reply ":"")+(c.pending?"pending":"")+'" role="listitem">'
      +'<div class="tc-card-meta">'
      +'<img src="'+c.pic+'" class="tc-card-pfp" alt="'+c.name+'" loading="lazy">'
      +'<span class="tc-card-name">'+c.name+'</span>'
      +(c.isPostAdmin ? '<span class="tc-admin-badge">ADMIN ‚≠ê</span>' : "")
      +starStr
      +'<span class="tc-card-time">'+c.date+'</span>'
      +'</div>'
      +'<div class="tc-card-body" id="body-'+c.rowId+'">'+c.comment+'</div>'
      +'<div class="tc-actions">'
      +'<button id="like-btn-'+c.rowId+'" data-liked="'+(isLiked?"1":"0")+'" '
      +'onclick="handleLike(\''+c.rowId+'\')" '
      +'style="background:none;border:none;cursor:pointer;font-size:15px;padding:2px 4px;'
      +'border-radius:20px;display:inline-flex;align-items:center;gap:4px;transition:transform 0.2s;">'
      +(isLiked ? "‚ù§Ô∏è" : "ü§ç")
      +' <span id="like-count-'+c.rowId+'" style="font-size:12px;font-weight:700;color:var(--text-muted,#666);">'+likeCount+'</span>'
      +'</button>'
      +'<button onclick="checkAuthAndOpen(\''+c.rowId+'\',\'reply\')">Reply</button>'
      +(canEdit   ? '<button onclick="checkAuthAndOpen(\''+c.rowId+'\',\'edit\')">Edit</button>'   : "")
      +(canDelete ? '<button style="color:var(--red,#ef4444)" onclick="deleteMsg(\''+c.rowId+'\')">Delete</button>' : "")
      +'</div>'
      +'<div id="box-'+c.rowId+'" class="tc-inline-box"></div>'
      +'</div>';

    list.filter(function(r){ return r.parentId == c.rowId; })
        .forEach(function(r){ html += renderCard(r, list); });
    return html;
  }

  window.checkAuthAndOpen = function(id, type) {
    if (!user) return alert("Login to interact!");
    isTyping = true;
    document.querySelectorAll(".tc-inline-box").forEach(function(b){ b.innerHTML = ""; });
    var box = document.getElementById("box-"+id);
    if (type === "reply") {
      box.innerHTML = '<textarea id="reply-in-'+id+'" placeholder="Write a reply..."></textarea>'
        +'<div style="text-align:right;margin-top:5px;">'
        +'<button onclick="isTyping=false;this.parentElement.parentElement.innerHTML=\'\'" '
        +'style="background:none;border:none;cursor:pointer;font-size:12px;margin-right:10px;color:var(--text-muted,#666)">Cancel</button>'
        +'<button class="tc-post-btn" onclick="handleAction(\''+id+'\')">Reply</button></div>';
    } else {
      var old = document.getElementById("body-"+id) ? document.getElementById("body-"+id).innerText : "";
      box.innerHTML = '<textarea id="edit-in-'+id+'">'+old+'</textarea>'
        +'<div style="text-align:right;margin-top:5px;">'
        +'<button onclick="isTyping=false;this.parentElement.parentElement.innerHTML=\'\'" '
        +'style="background:none;border:none;cursor:pointer;font-size:12px;margin-right:10px;color:var(--text-muted,#666)">Cancel</button>'
        +'<button class="tc-post-btn" onclick="handleAction(\'0\',\'edit\',\''+id+'\')">Update</button></div>';
    }
    var ta = box.querySelector("textarea"); if (ta) ta.focus();
  };

  window.deleteMsg = async function(id) {
    if (!confirm("Delete permanently?")) return;
    await fetch(SU, { method:"POST", mode:"no-cors",
      body: JSON.stringify({ action:"delete", rowId:id, userEmail:user.e }) });
    sync();
  };

  init();
})();
</script>

<script src="https://accounts.google.com/gsi/client" async defer></script>

{% endif %}

<!-- FOOTER -->
<footer class="tc-footer" role="contentinfo">
  <div class="footer-grid">
    <div>
      <h3>About Tyagi Core</h3>
      <p>Innovation and education without limits. Deep tech insights for everyone.</p>
    </div>
    <div>
      <h4>Pages</h4>
      <a href="{{ '/about'   | absolute_url }}">About</a>
      <a href="{{ '/privacy' | absolute_url }}">Privacy Policy</a>
      <a href="{{ '/terms'   | absolute_url }}">Terms of Service</a>
    </div>
    <div>
      <h4>Categories</h4>
      <p>Cyber Security</p><p>Networking</p><p>AI & Linux</p>
    </div>
    <div>
      <h4>Social</h4>
      <a href="https://t.me/TyagiCore"              target="_blank" rel="noopener noreferrer">Telegram</a>
      <a href="https://youtube.com/@tyagicore"      target="_blank" rel="noopener noreferrer">YouTube</a>
      <a href="https://instagram.com/tyagicore"     target="_blank" rel="noopener noreferrer">Instagram</a>
      <a href="https://facebook.com/himanshutyagie" target="_blank" rel="noopener noreferrer">Facebook</a>
    </div>
  </div>
  <div class="footer-bottom">
    <p>¬© {{ site.time | date: "%Y" }} {{ site.title }}. All rights reserved.</p>
  </div>
</footer>

<button id="tyagi-top-wrap" aria-label="Scroll to top">
  <svg class="tyagi-progress-svg" viewBox="-1 -1 102 102" aria-hidden="true">
    <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
  </svg>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" color= "var(--text-color)" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" style="display: inline-block; vertical-align: middle;">
    <polyline points="17 8 12 3 7 8"></polyline>
    <line x1="12" y1="3" x2="12" y2="15"></line>
   
</svg>
</button>

<script>
window.tyagiPosts = [
  {% assign all_posts = site.pages | where: "is_post", true %}
  {% for p in all_posts %}{"title":{{ p.title | jsonify }},"url":{{ p.url | relative_url | jsonify }},"image":{{ p.image | default: "" | jsonify }},"excerpt":{{ p.description | default: "" | strip_html | truncate: 120 | jsonify }}}{% unless forloop.last %},{% endunless %}{% endfor %}
];
</script>
<script src="{{ '/assets/js/main.js' | absolute_url }}" defer></script>

</body>
</html>
