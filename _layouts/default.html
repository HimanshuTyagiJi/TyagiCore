<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{{ page.title }} | {{ site.title }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
{% seo %}
<link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css' rel='stylesheet'/>
<link rel="stylesheet" href="{{ 'assets/css/style.css' | absolute_url }}">
</head>
<body>

<header class="header">
  <div class="header-inner">
<a href="{{ '/' | relative_url }}" class="logo">
<img src="{{ 'assets/images/tyagi_core.png' | relative_url }}" alt="Tyagi Core" style="height: 40px; vertical-align: middle;">
<span><svg width="220" height="60" viewBox="0 0 500 150"
     xmlns="http://www.w3.org/2000/svg">

  <defs>
    <linearGradient id="gradMove" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#4285F4">
        <animate attributeName="offset" values="0;1;0" dur="4s" repeatCount="indefinite"/>
      </stop>
      <stop offset="0.5" stop-color="#EA4335">
        <animate attributeName="offset" values="0.5;1.5;0.5" dur="4s" repeatCount="indefinite"/>
      </stop>
      <stop offset="1" stop-color="#34A853">
        <animate attributeName="offset" values="1;2;1" dur="4s" repeatCount="indefinite"/>
      </stop>
    </linearGradient>
  </defs>

  <!-- TYAGI (Animated Stroke Draw) -->
  <text x="10" y="60"
        font-size="70"
        font-weight="900"
        font-family="Poppins, sans-serif"
        fill="none"
        stroke="url(#gradMove)"
        stroke-width="3"
        stroke-dasharray="1000"
        stroke-dashoffset="1000">

    Tyagi

    <animate attributeName="stroke-dashoffset"
             values="1000;0;1000"
             dur="6s"
             repeatCount="indefinite"/>
  </text>

  <!-- CORE (Outline Only) -->
  <text x="10" y="140"
        font-size="60"
        font-weight="900"
        font-family="Poppins, sans-serif"
        fill="none"
        stroke="url(#gradMove)"
        stroke-width="3"
        stroke-linejoin="round"
        stroke-linecap="round">

    CORE

    <!-- Light pulse animation -->
    <animate attributeName="stroke-width"
             values="3;4;3"
             dur="2s"
             repeatCount="indefinite"/>
  </text>

</svg></span>
</a>

<style>
.logo {
 
  vertical-align: middle;
  transition: transform 0.3s ease;
}

.logo:hover {
  transform: scale(1.05);
}

.logo svg {

  height: 25px;
  width: auto;
}
</style>
   <nav class="nav">
  <a href="{{ '' | absolute_url }}">Home</a>
  <a href="{{ 'networking' | absolute_url }}">Networking</a>
  <a href="{{ 'cyber' | absolute_url }}">Cyber</a>
  <a href="{{ 'ai' | absolute_url }}">AI</a>
  <a href="{{ 'linux' | absolute_url }}">Linux</a>
  <a href="{{ 'privacy' | absolute_url }}">Privacy</a>
  <a href="{{ 'cloud' | absolute_url }}">Cloud</a>
</nav>
    <div class="right-icons">
      <svg class="icon-btn" onclick="toggleSearch(true)" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"></circle><line x1="16.5" y1="16.5" x2="21" y2="21"></line></svg>
      <svg class="icon-btn hamburger" onclick="toggleMenu(true)" viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </div>
  </div>
</header>
<div id="reading-progress-container">
  <div id="reading-progress-bar"></div>
</div>

<div id="searchModal" onclick="closeOnOverlay(event)">
  <div class="search-box">
    <div class="search-input-area">
      <input type="text" id="searchInput" placeholder="Search articles (fuzzy)..." onkeyup="globalSearch()">
      <span class="close-modal" onclick="toggleSearch(false)">‚úï</span>
    </div>
    <div id="searchResults">
      <p style="text-align:center; padding:20px; color:#94a3b8;">Start typing to search...</p>
    </div>
  </div>
</div>

<div class="mobile-overlay" onclick="toggleMenu(false)"></div>
<div class="mobile-menu">
  <div class="mobile-header"> <a href="{{ '/' | relative_url }}" class="logo">
  <img src="{{ 'assets/images/tyagi_core.png' | relative_url }}" alt="Tyagi Core" style="height: 40px; vertical-align: middle; margin-right: 10px;">
  <span>TYAGI CORE</span>
</a><span onclick="toggleMenu(false)" style="cursor:pointer;">‚úï</span></div>
  <div class="mobile-nav">

  <a href="{{ '' | absolute_url }}">Home</a>
  <a href="{{ 'networking' | absolute_url }}">Networking</a>
  <a href="{{ 'cyber' | absolute_url }}">Cyber</a>
  <a href="{{ 'ai' | absolute_url }}">AI</a>
  <a href="{{ 'linux' | absolute_url }}">Linux</a>
  <a href="{{ 'privacy' | absolute_url }}">Privacy</a>

  </div>
</div>

{% if page.url == "/" or page.url == "/TyagiCore/" %}
<section class="tc-hero">
  <h1>Build Real Tech From Scratch</h1>
  <p>Practical guides & projects to master the tech world</p>
  <a href="#" class="btn btn-primary">Learn Now</a>
  <a href="#" class="btn btn-outline">Explore Projects</a>
</section>


{% endif %}
<div id="index-category-nav"></div>
<main class="tc-wrapper">
  <div class="tc-left">
    {% unless page.url == "/" or page.url == "/TyagiCore/" %}
<div class="toc-container" id="toc-box" style="display:none;">
  <div class="toc-title">
    <i class="fas fa-list-ul"></i> Topics 
  </div>
  <ul id="toc-list"></ul>
  <div id="toc-toggle-btn" class="toc-see-more">
    See More <i class="fas fa-chevron-down"></i>
  </div>
</div>


{% endunless %}


    
    {{ content }}

    {% unless page.url == "/" or page.url == "/TyagiCore/" %}
<div class="share-wrapper">
  <p class="share-label">Pasand aaya? Doston se share karein!</p>
  <button onclick="tyagiShare()" class="tyagi-share-btn">
    <i class="fas fa-paper-plane"></i> SHARE ARTICLE
  </button>
</div>



<div class="post-nav-container">
  
  <div class="post-nav-link prev">
    {% if page.previous %}
      <a href="{{ page.previous.url | relative_url }}">
        <span class="nav-label"><i class="fas fa-arrow-left"></i> Privious</span>
        <div class="nav-post-title">{{ page.previous.title }}</div>
      </a>
    {% endif %}
  </div>

  <div class="post-nav-link next">
    {% if page.next %}
      <a href="{{ page.next.url | relative_url }}">
        <span class="nav-label">Next <i class="fas fa-arrow-right"></i></span>
        <div class="nav-post-title">{{ page.next.title }}</div>
      </a>
    {% endif %}
  </div>
  
</div>

<hr style="margin: 50px 0;">

  

{% endunless %}
  </div>

  </div>
  

  <aside class="tc-sidebar">
<div class="box">Trending Now</div>
<div id="trending-sidebar-items">
  </div>

   <script>
  window.tyagiPosts = [
    {% assign all_posts = site.pages | where: "is_post", true %}
    {% for p in all_posts limit:10 %}
    {
      "title": {{ p.title | jsonify }},
      "url": {{ p.url | relative_url | jsonify }},
      "image": "{{ p.image | default: 'https://picsum.photos/400/300' }}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];
</script>
  <script>
  function loadTrendingSidebar() {
    const container = document.getElementById('trending-sidebar-items');
    if (!container || !window.tyagiPosts || window.tyagiPosts.length === 0) return;

    // 6 Hours Rotation Logic
    const timeSeed = Math.floor(Date.now() / (1000 * 60 * 60 * 6));

    // Shuffle Posts
    let shuffled = [...window.tyagiPosts].sort((a, b) => {
        return Math.sin(timeSeed + a.title.length) - 0.5;
    });

    // Pick 2 Posts
    const selected = shuffled.slice(0, 2);

    let html = '';
    selected.forEach(post => {
        html += `
            <a href="${post.url}" class="trend-card" style="display:flex; gap:10px; margin-bottom:15px; text-decoration:none; align-items:center;">
                <img src="${post.image}" class="trend-thumb" style="width:70px; height:50px; object-fit:cover; border-radius:6px; border:1px solid #eee;">
                <span class="trend-title" style="font-size:14px; font-weight:600; color:var(--text-color); line-height:1.3;">${post.title}</span>
            </a>`;
    });

    container.innerHTML = html;
}

// Ensure it runs
document.addEventListener('DOMContentLoaded', loadTrendingSidebar);
window.addEventListener('load', loadTrendingSidebar);
    </script>
    
    
    
    <style>

.trending-wrapper {
    padding: 10px 0;
}

.trend-card {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    margin-bottom: 15px;
    transition: transform 0.2s ease;
}

.trend-card:hover {
    transform: translateX(5px);
}

.trend-thumb {
    width: 65px;
    height: 45px;
    object-fit: cover;
    border-radius: 6px;
    border: 1px solid var(--border-color);
}

.trend-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-color);
    line-height: 1.3;
}

.trend-card:hover .trend-title {
    color: #1a73e8; /* Hover par blue color */
}
      
    </style>

<h3>Our App</h3>
<div class='tyagi-app-container'>
  
  <div class='app-card'>
    <img class='app-logo' src='https://placehold.co/60x60/2563eb/white?text=TC' alt='App Logo'/>
    <div class='app-details'>
      <span class='app-name'>TyagiCore Pro</span>
      <span class='app-meta'>v1.2 ‚Ä¢ 15 MB</span>
    </div>
    <a class='download-btn' href='#' title='Download APK'>Download</a>
  </div>

  <div class='app-card'>
    <img class='app-logo' src='https://placehold.co/60x60/16a34a/white?text=GK' alt='App Logo'/>
    <div class='app-details'>
      <span class='app-name'>GK Learn Quiz</span>
      <span class='app-meta'>v2.0 ‚Ä¢ 12 MB</span>
    </div>
    <a class='download-btn' href='#' title='Download APK'>Download</a>
  </div>

  <div class='app-card'>
    <img class='app-logo' src='https://placehold.co/60x60/8b5cf6/white?text=AR' alt='App Logo'/>
    <div class='app-details'>
      <span class='app-name'>Arataai Connect</span>
      <span class='app-meta'>v1.0 ‚Ä¢ 18 MB</span>
    </div>
    <a class='download-btn' href='#' title='Download APK'>Download</a>
  </div>

  <div class='app-card'>
    <img class='app-logo' src='https://placehold.co/60x60/f59e0b/white?text=App' alt='App Logo'/>
    <div class='app-details'>
      <span class='app-name'>App Name 4</span>
      <span class='app-meta'>v1.0 ‚Ä¢ 10 MB</span>
    </div>
    <a class='download-btn' href='#' title='Download APK'>Download</a>
  </div>

  </div>



<h3>Follow Us</h3>
    
  <div class='tyagi-social-hub'>
  <a class='hub-card yt-main' href='https://youtube.com/@tyagicore' target='_blank'>
    <div class='hub-icon'><i class='fab fa-youtube'></i></div>
    <div class='hub-info'>
      <span class='hub-name'>TyagiCore</span>
      <span class='hub-desc'>Tech & Systems</span>
    </div>
    <div class='hub-action'>Join</div>
  </a>

  <a class='hub-card study-card' href='https://youtube.com/@gklernstudy' target='_blank'>
    <div class='hub-icon'><i class='fas fa-graduation-cap'></i></div>
    <div class='hub-info'>
      <span class='hub-name'>GK Learn Study</span>
      <span class='hub-desc'>Education Hub</span>
    </div>
    <div class='hub-action'>Join</div>
  </a>

  <a class='hub-card ig-card' href='https://instagram.com/your-id' target='_blank'>
    <div class='hub-icon'><i class='fab fa-instagram'></i></div>
    <div class='hub-info'>
      <span class='hub-name'>Instagram</span>
      <span class='hub-desc'>Daily Updates</span>
    </div>
    <div class='hub-action'>Follow</div>
  </a>

  <a class='hub-card fb-card' href='https://facebook.com/your-page' target='_blank'>
    <div class='hub-icon'><i class='fab fa-facebook-f'></i></div>
    <div class='hub-info'>
      <span class='hub-name'>Facebook</span>
      <span class='hub-desc'>Community</span>
    </div>
    <div class='hub-action'>Like</div>
  </a>

  <a class='hub-card arataai-card' href='https://arataai.com' target='_blank'>
    <div class='hub-icon'><i class='fas fa-link'></i></div>
    <div class='hub-info'>
      <span class='hub-name'>Arataai</span>
      <span class='hub-desc'>Partner Site</span>
    </div>
    <div class='hub-action'>Visit</div>
  </a>

  <a class='hub-card tg-card' href='https://t.me/tyagicore' target='_blank'>
    <div class='hub-icon'><i class='fab fa-telegram-plane'></i></div>
    <div class='hub-info'>
      <span class='hub-name'>Telegram</span>
      <span class='hub-desc'>Direct Files</span>
    </div>
    <div class='hub-action'>Join</div>
  </a>
</div>


  </aside>
</main>

{% if page.url == "/" or page.url == "/TyagiCore/" %}
<section class="tc-tools">
  <h2>Tools & Projects</h2>
  <div class="tools-grid">
    <div class="card">Mini Projects</div>
    <div class="card">Free Tools</div>
    <div class="card">Downloads</div>
    <div class="card">Code Snippets</div>
  </div>
</section>
{% endif %}




<div id="dark-mode-toggle" class="theme-wheel">
  <div class="wheel-icon-wrap">
    <i class="fas fa-moon moon-icon"></i>
    <i class="fas fa-sun sun-icon"></i>
  </div>
</div>

<div id="tc-root">
  <div  style="display: flex;" class="tc-header">
    <div class="tc-header-left">
      <h2 style="margin:0; font-size:18px;">Discussion & Reviews</h2>
      <div id="tc-rating-summary" class="tc-ps-rating">
        <span id="tc-avg-num" class="tc-avg-big">0.0</span>
        <div class="tc-ps-stars-wrap">
          <div id="tc-avg-stars" class="tc-stars-fs">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <div id="tc-total-votes" class="tc-total-v">0 reviews</div>
        </div>
      </div>
    </div>
    <div id="tc-auth-zone">
      <div id="tc-auth-gate">
        <div id="g_id_onload" data-client_id="307990626713-iajvibefe9hrour51knqkcc5obouuher.apps.googleusercontent.com" data-callback="onGoogleAuth"></div>
        <div class="g_id_signin" data-type="standard" data-shape="pill"></div>
      </div>
      <div id="tc-user-pill" style="display:none" class="tc-user-pill">
        <img id="tc-user-pfp" src="" class="tc-pfp-small">
        <span id="tc-user-name" class="tc-u-name"></span>
        <button onclick="tcLogout()" class="tc-logout-btn">Logout</button>
      </div>
    </div>
  </div>

  <div class="tc-user-rate-box">
    <p style="margin:0 0 5px 0; font-size:12px; color:#666;">Tap stars to rate:</p>
    <div id="tc-star-row" class="tc-stars-input">
      <span class="tc-s" onclick="handleStar(1)" onmouseover="hoverStar(1)" onmouseout="resetStar()">‚òÖ</span>
      <span class="tc-s" onclick="handleStar(2)" onmouseover="hoverStar(2)" onmouseout="resetStar()">‚òÖ</span>
      <span class="tc-s" onclick="handleStar(3)" onmouseover="hoverStar(3)" onmouseout="resetStar()">‚òÖ</span>
      <span class="tc-s" onclick="handleStar(4)" onmouseover="hoverStar(4)" onmouseout="resetStar()">‚òÖ</span>
      <span class="tc-s" onclick="handleStar(5)" onmouseover="hoverStar(5)" onmouseout="resetStar()">‚òÖ</span>
    </div>
  </div>

  <div id="tc-main-editor" class="tc-editor-box">
    <textarea id="tc-input" placeholder="Join the discussion..."></textarea>
    <div style="text-align:right; margin-top:8px;">
      <button onclick="handleAction('0')" class="tc-post-btn">Post Comment</button>
    </div>
  </div>

  <div id="tc-feed" class="tc-feed"></div>
</div>


   

<footer class="tc-footer">
  <div class="footer-grid">
    <div><h3>About Tyagi Core</h3><p>Innovation and education without limits. Deep tech insights for everyone.</p></div>
    <div><h4>About</h4><p>Contact</p><p>Privacy Policy</p></div>
    <div><h4>Categories</h4><p>Cyber Security</p><p>System Design</p></div>
    <div><h4>Social</h4><p>Telegram</p><p>GitHub</p></div>
  </div>
  <div class="footer-bottom">
    <p>¬© {{ site.time | date: "%Y" }} {{ site.title }}. All rights reserved.</p>
  </div>
</footer>
<div id="tyagi-top-wrap">
  <svg class="tyagi-progress-svg" width="100%" height="100%" viewBox="-1 -1 102 102">
    <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
  </svg>
  <i class="fas fa-arrow-up top-arrow-icon"></i>
</div>

 <script>
  window.tyagiPosts = [
    {% assign all_posts = site.pages | where: "is_post", true %}
    {% for p in all_posts %} // Limit yahan se hata di, Sidebar function mein handle karenge
    {
      "title": {{ p.title | jsonify }},
      "url": {{ p.url | relative_url | jsonify }},
      "image": "{{ p.image | default: 'https://picsum.photos/400/300' }}",
      "excerpt": {{ p.description | default: p.excerpt | strip_html | truncate: 100 | jsonify }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];
</script>
 <script src="{{ 'assets/js/main.js' | absolute_url }}" defer></script> 
 <script src="https://accounts.google.com/gsi/client" async defer></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-messaging.js";

const firebaseConfig = {
  apiKey           : "AIzaSyCFIKqQ5OICMZhWPtZqmgem0bEW7QpoPcw",
  authDomain       : "appcomment.firebaseapp.com",
  projectId        : "appcomment",
  storageBucket    : "appcomment.firebasestorage.app",
  messagingSenderId: "156258808941",
  appId            : "1:156258808941:web:04a1f7470ac43657c7fb64"
};

const VAPID_KEY  = "BPSPa7nCW1nGok9peZQepk25VC1OxeFxFHtWVZsen2TnwVCya3Sq2Dtb4W0sX8u06fRsg-eAqgxEUoW2XP1Oyvo";
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbympst5_Jwnf_IMo6aiSe0pxryLrrmdDY6ZfH7uf5Km69lZNTDD2OwqWGzstzKVPQvw/exec";

const app       = initializeApp(firebaseConfig);
const messaging = getMessaging(app);

window._tcInitFCM = async function() {
  const storedUser = JSON.parse(localStorage.getItem("tc_user"));
  if (!storedUser) return;
  try {
    const sw = await navigator.serviceWorker.register('./sw.js', { scope: './' });
    await navigator.serviceWorker.ready;
    const perm = await Notification.requestPermission();
    if (perm !== "granted") return;
    const token = await getToken(messaging, { vapidKey: VAPID_KEY, serviceWorkerRegistration: sw });
    if (token) {
      fetch(SCRIPT_URL, {
        method: "POST", mode: "no-cors",
        body: JSON.stringify({ action: "fcm_subscribe", fcmToken: token, email: storedUser.e, name: storedUser.n })
      });
      console.log("FCM ready ‚úÖ");
    }
  } catch(err) { console.log("FCM Error:", err); }

 
  onMessage(messaging, function(payload) {
    var title  = payload.notification ? payload.notification.title : "TyagiCore üîî";
    var body   = payload.notification ? payload.notification.body  : "";
    var url    = (payload.data && payload.data.url) ? payload.data.url : "https://tyagicore.gklearnstudy.in";
    if (url.startsWith("/")) url = "https://tyagicore.gklearnstudy.in" + url;

    navigator.serviceWorker.ready.then(function(reg) {
      reg.showNotification(title, {
        body   : body,
        icon   : "/assets/images/tyagi_core.png",
        tag    : "tc-notif",
        data   : { url: url },
        vibrate: [200, 100, 200]
      });
    });
  });
};


  (function() {
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbympst5_Jwnf_IMo6aiSe0pxryLrrmdDY6ZfH7uf5Km69lZNTDD2OwqWGzstzKVPQvw/exec";

  let user          = JSON.parse(localStorage.getItem("tc_user")) || null;
  let serverData    = [];
  let tempLocal     = [];
  let isTyping      = false;
  let currentRating = 0;

  function init() {
    if (user) {
      document.getElementById("tc-auth-gate").style.display = "none";
      document.getElementById("tc-user-pill").style.display = "flex";
      document.getElementById("tc-user-name").innerText = user.n;
      document.getElementById("tc-user-pfp").src = user.p;
      setTimeout(function() { if (window._tcInitFCM) window._tcInitFCM(); }, 1500);
    }
    sync();
    setInterval(function() { if (!isTyping) sync(); }, 5000);
  }

  window.onGoogleAuth = function(r) {
    var p = JSON.parse(atob(r.credential.split('.')[1]));
    user  = { n: p.name, e: p.email, p: p.picture };
    localStorage.setItem("tc_user", JSON.stringify(user));
    location.reload();
  };

  window.tcLogout = function() { localStorage.removeItem("tc_user"); location.reload(); };

  window.hoverStar = function(n) { if (!isTyping && currentRating === 0) paintStars(n); };
  window.resetStar = function()  { paintStars(currentRating); };
  window.handleStar = function(n) {
    if (!user) return alert("Login required to rate!");
    currentRating = n;
    paintStars(n);
    fetch(SCRIPT_URL, {
      method: "POST", mode: "no-cors",
      body: JSON.stringify({ url: location.pathname, email: user.e, rating: n, comment: "__RATING_ONLY__" })
    });
  };
  function paintStars(n) {
    document.querySelectorAll(".tc-s").forEach(function(s, i) { s.classList.toggle("active", i < n); });
  }

  window.handleAction = function(pid, mode, rowId) {
    mode  = mode  || "new";
    rowId = rowId || null;
    if (!user) return alert("Please Login!");
    var inputId = mode === "edit" ? "edit-in-" + rowId : (pid === "0" ? "tc-input" : "reply-in-" + pid);
    var inputEl = document.getElementById(inputId);
    var msg     = inputEl.value.trim();
    if (!msg) return;
    if (mode === "new") {
      tempLocal.push({ rowId: "temp_"+Date.now(), name: user.n, comment: msg, parentId: pid, pic: user.p, date: "Saving...", pending: true, isAdmin: false, email: user.e });
    } else {
      var t = serverData.find(function(c) { return c.rowId == rowId; });
      if (t) { t.comment = msg; t.date = "Updating..."; }
    }
    render();
    inputEl.value = "";
    isTyping = false;
    var payload = { url: location.pathname, name: user.n, email: user.e, pic: user.p, comment: msg, parentId: pid, rating: currentRating };
    if (mode === "edit") { payload.action = "edit"; payload.rowId = rowId; }
    fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(payload), mode: "no-cors" });
    setTimeout(sync, 1500);
  };

  async function sync() {
    try {
      var emailParam = user ? "&email=" + encodeURIComponent(user.e) : "";
      var r    = await fetch(SCRIPT_URL + "?url=" + location.pathname + emailParam);
      var data = await r.json();
      serverData = data.comments;
      tempLocal  = [];
      if (user && data.myRating > 0) currentRating = data.myRating;
      updateRatingUI(data.avgRating, data.totalVotes);
      paintStars(currentRating);
      render();
    } catch(e) {}
  }

  function updateRatingUI(avg, total) {
    document.getElementById("tc-avg-num").innerText     = avg;
    document.getElementById("tc-total-votes").innerText = total + " reviews";
    var stars = "", rounded = Math.round(parseFloat(avg));
    for (var i = 1; i <= 5; i++) stars += i <= rounded ? "‚òÖ" : "‚òÜ";
    document.getElementById("tc-avg-stars").innerText = stars;
  }

  function render() {
    var feed     = document.getElementById("tc-feed");
    var combined = serverData.concat(tempLocal);
    var mains    = combined.filter(function(c) { return c.parentId == "0"; }).reverse();
    feed.innerHTML = mains.map(function(m) { return renderCard(m, combined); }).join("");
  }

  function renderCard(c, list) {
    var canEdit = user && (user.e === c.email);
    var starStr = c.userRating > 0 ? '<span style="color:#f4b400;font-size:10px;margin-left:8px;">' + "‚òÖ".repeat(c.userRating) + '</span>' : "";
    var html = '<div class="tc-card ' + (c.parentId !== "0" ? "reply " : "") + (c.pending ? "pending" : "") + '">'
      + '<div><img src="' + c.pic + '" class="tc-card-pfp">'
      + '<span style="font-weight:bold;font-size:14px;">' + c.name + '</span>'
      + (c.isAdmin ? '<span class="tc-admin-badge">ADMIN ‚≠ê</span>' : '')
      + starStr
      + '<small style="float:right;color:#999;">' + c.date + '</small></div>'
      + '<div style="margin:8px 0 0 42px;font-size:14px;color:var(--text-color);" id="body-' + c.rowId + '">' + c.comment + '</div>'
      + '<div class="tc-actions">'
      + '<span onclick="checkAuthAndOpen(\'' + c.rowId + '\',\'reply\')">Reply</span>'
      + (canEdit ? '<span onclick="checkAuthAndOpen(\'' + c.rowId + '\',\'edit\')">Edit</span>' : '')
      + (canEdit ? '<span style="color:#d93025" onclick="deleteMsg(\'' + c.rowId + '\')">Delete</span>' : '')
      + '</div><div id="box-' + c.rowId + '" class="tc-inline-box"></div></div>';
    list.filter(function(r) { return r.parentId == c.rowId; })
        .forEach(function(r) { html += renderCard(r, list); });
    return html;
  }

  window.checkAuthAndOpen = function(id, type) {
    if (!user) return alert("Login to interact!");
    isTyping = true;
    document.querySelectorAll(".tc-inline-box").forEach(function(b) { b.innerHTML = ""; });
    var box = document.getElementById("box-" + id);
    if (type === "reply") {
      box.innerHTML = '<textarea id="reply-in-' + id + '" placeholder="Write a reply..."></textarea>'
        + '<div style="text-align:right;margin-top:5px;">'
        + '<button onclick="isTyping=false;this.parentElement.parentElement.innerHTML=\'\'" style="background:none;border:none;cursor:pointer;font-size:12px;margin-right:10px;">Cancel</button>'
        + '<button class="tc-post-btn" onclick="handleAction(\'' + id + '\')">Reply</button></div>';
    } else {
      var old = document.getElementById("body-" + id).innerText;
      box.innerHTML = '<textarea id="edit-in-' + id + '">' + old + '</textarea>'
        + '<div style="text-align:right;margin-top:5px;">'
        + '<button onclick="isTyping=false;this.parentElement.parentElement.innerHTML=\'\'" style="background:none;border:none;cursor:pointer;font-size:12px;margin-right:10px;">Cancel</button>'
        + '<button class="tc-post-btn" onclick="handleAction(\'0\',\'edit\',\'' + id + '\')">Update</button></div>';
    }
    box.querySelector("textarea").focus();
  };

  window.deleteMsg = async function(id) {
    if (!confirm("Delete permanently?")) return;
    await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ action: "delete", rowId: id, userEmail: user.e }), mode: "no-cors" });
    sync();
  };

  init();
})();
</script>
</body>
</html>
