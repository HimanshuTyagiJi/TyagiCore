<div id="comment-section" style="max-width: 600px; margin: 20px auto; font-family: Arial, sans-serif; padding: 10px; border: 1px solid #ddd; border-radius: 8px; background: #fff;">
    <h3 style="text-align: center; color: #333;">Comments ,</h3>

    <form id="comment-form" onsubmit="submitComment(event)" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
        <input type="text" id="user-name" placeholder="Aapka Naam" required style="padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
        <textarea id="user-comment" placeholder="Apna comment likhein..." required style="padding: 10px; border: 1px solid #ccc; border-radius: 4px; min-height: 80px;"></textarea>
        <button type="submit" id="submit-btn" style="padding: 10px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Post Comment</button>
    </form>

    <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

    <div id="comments-container">
        <p style="text-align: center; color: #888;">Comments load ho rahe hain...</p>
    </div>
</div>

<script>
    // 1. TERA GOOGLE SCRIPT URL (Don't change this)
    const API_URL = "https://script.google.com/macros/s/AKfycbyHafCHqnjst1Zzm-tnc1Vt9rhjB0cSQAuCe438PGmlMGo12r31NULdexrjMsBgRMP-/exec";

    // 2. Comments Load Karne Wala Function
    async function loadComments() {
        const pageUrl = window.location.pathname; 
        const container = document.getElementById("comments-container");

        try {
            const response = await fetch(`${API_URL}?url=${encodeURIComponent(pageUrl)}`);
            const comments = await response.json();
            
            container.innerHTML = ""; 

            if (comments.length === 0) {
                container.innerHTML = "<p style='text-align:center; color:#999;'>Pehla comment aap karein!</p>";
                return;
            }

            comments.forEach(c => {
                const div = document.createElement("div");
                div.style = "border-bottom: 1px solid #eee; padding: 10px 0; margin-bottom: 5px;";
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong style="color: #007bff;">${c.name}</strong>
                        <small style="color: #999; font-size: 11px;">${c.date}</small>
                    </div>
                    <p style="margin: 5px 0; color: #444; font-size: 14px;">${c.comment}</p>
                `;
                container.appendChild(div);
            });
        } catch (e) {
            container.innerHTML = "<p style='color:red; text-align:center;'>Comments load nahi ho paye!</p>";
            console.error(e);
        }
    }

    // 3. Comment Post Karne Wala Function
    async function submitComment(e) {
        e.preventDefault();
        
        const btn = document.getElementById("submit-btn");
        const nameField = document.getElementById("user-name");
        const commentField = document.getElementById("user-comment");
        const pageUrl = window.location.pathname;

        // Button ko lock kar do
        btn.innerText = "Posting...";
        btn.disabled = true;

        // Data taiyar karo
        const payload = new URLSearchParams({
            "url": pageUrl,
            "name": nameField.value,
            "comment": commentField.value
        });

        try {
            // Google Script ko bhej do
            await fetch(API_URL, {
                method: "POST",
                body: payload,
                mode: "no-cors" // Sabse zaruri bypass
            });

            // Form khali karo aur success message dikhao
            nameField.value = "";
            commentField.value = "";
            alert("Comment successfully post ho gaya!");
            
            // 1 second baad naye comments load karo
            setTimeout(loadComments, 1000);
        } catch (e) {
            alert("Kuch galti hui! Dobara try karein.");
            console.error(e);
        } finally {
            btn.innerText = "Post Comment";
            btn.disabled = false;
        }
    }

    // Page khulte hi comments dikhao
    window.onload = loadComments;
</script>
