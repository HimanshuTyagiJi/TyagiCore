<div id="tyagi-comment-box" style="max-width:800px; margin:40px auto; padding:25px; background:#fff; border-radius:12px; box-shadow:0 8px 25px rgba(0,0,0,0.1); font-family:sans-serif; border:1px solid #eee;">
    <h3 style="color:#166534; border-bottom:2px solid #166534; padding-bottom:12px; margin-top:0;">ðŸ’¬ Jan-Samvad (Comments)</h3>

    <div style="margin-top:20px;">
        <input type="text" id="c-name" placeholder="Apna Naam" style="width:100%; padding:14px; margin-bottom:12px; border:1.5px solid #ddd; border-radius:8px; box-sizing:border-box; outline:none; font-size:16px;">
        <textarea id="c-msg" placeholder="Apne vichar likhein..." style="width:100%; height:100px; padding:14px; margin-bottom:12px; border:1.5px solid #ddd; border-radius:8px; box-sizing:border-box; outline:none; font-size:16px; resize:vertical;"></textarea>
        <button onclick="postComment()" id="send-btn" style="background:#166534; color:white; border:none; padding:14px 25px; border-radius:8px; cursor:pointer; width:100%; font-weight:bold; font-size:16px; transition:0.3s;">Post Comment</button>
    </div>

    <hr style="margin:30px 0; border:0; border-top:1px solid #eee;">
    <div id="comments-display" style="min-height:50px;">Loading comments...</div>
</div>

<script>
// TERA NAYA CLOUDFLARE WORKER ROUTE
const API = "https://tyagicore.gklearnstudy.in/api"; 
const PAGE_ID = window.location.pathname;

async function loadComments() {
    try {
        // Worker ke raste data mangwa rahe hain
        const res = await fetch(`${API}?url=${encodeURIComponent(PAGE_ID)}`);
        const data = await res.json();
        const div = document.getElementById('comments-display');
        
        if (!data || data.length === 0) {
            div.innerHTML = "<p style='color:#888; text-align:center;'>Phela comment aap karein!</p>";
            return;
        }

        div.innerHTML = data.map(c => `
            <div style="background:#fdfdfd; padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid #f0f0f0; border-left:5px solid #166534;">
                <strong style="color:#333;">${c.user_name}</strong> 
                <small style="float:right; color:#aaa; font-size:12px;">${c.created_at}</small>
                <p style="margin:10px 0 0; color:#444; line-height:1.6;">${c.comment_text}</p>
            </div>
        `).join('');
    } catch (e) {
        document.getElementById('comments-display').innerHTML = "<p style='color:red; text-align:center;'>Comments load nahi ho paye. Worker check karein.</p>";
    }
}

async function postComment() {
    const name = document.getElementById('c-name').value;
    const msg = document.getElementById('c-msg').value;
    const btn = document.getElementById('send-btn');

    if(!name || !msg) return alert("Bhai, naam aur message dono likho!");

    btn.innerText = "Bheja ja raha hai...";
    btn.disabled = true;

    // Worker ko JSON bhej rahe hain
    try {
        const response = await fetch(API, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url: PAGE_ID, name: name, comment: msg })
        });
        
        const result = await response.json();
        if(result.status === "success") {
            document.getElementById('c-msg').value = '';
            loadComments(); // List refresh karo
        } else {
            alert("Error: " + result.message);
        }
    } catch (e) {
        alert("Bridge (Worker) me dikkat hai! Ek baar settings check karein.");
    } finally {
        btn.innerText = "Post Comment";
        btn.disabled = false;
    }
}

// Page load hote hi comments dikhao
loadComments();
</script>
